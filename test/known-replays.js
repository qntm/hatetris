"use strict";

var firstState = require("./../src/js/first-state.js");
var nextStateFactory = require("./../src/js/next-state-factory.js");
var oriGen = require("./../src/js/ori-gen.js");
var replay = require("./../src/js/replay.js");
var worstPieceFactory = require("./../src/js/worst-piece-factory.js");

describe("check known replays", function() {
	var knowns = [
		{
			name: "qntm",
			string: "ğ¤†»ğ¤†»ğ¤†»ğ¤†»ğ¤†»ğ¡š»",
			score: 0
		},
		{
			name: "Atypical",
			string: "ã¼¬ğ¤†»æ”Œğ£º»ã¼Œğ¤‚»ğ¤‡ƒã²¬ğ¤„‹ğ¤†œğ ¦»ğ¥„¸ä‚¹ğ£¸«ğ¤‡ğ¤¦¸ğ¤„¥ğ¤š¤ğ¤‚»ğ¤‡‹ğ¤ª„ğ¤†»é‚Œğ£Š»ğ¤…·ğ“»ğ¤†»ğ¤†„ğ“Šºğ¤†»ğ¤„‹ã¾…ğ¢¶»ğ¤…›ğ¤†¢ğ£š»ğ¤†´ğ“Šºğ£º»ğ¤„²å‚£ã¾¹ã¾¸ğ¢ª±ğ¢š»ç¶¸ğ¢°‹ğ š»é‚Œğ Š¹ğ£½‹ğ¤„°ç‚¸ğ¤†³ğ£¼°ğ¤‡€ğ£‹‹ğ£½›èƒ‡ğ“Š¸ğ ª»ğ¥¶»ğ£™»æ‚»êŠ¬è‚¬ğ“œğ¤²¸ğ¤º¸ğ ¤‹ğ¥‡”å‚œğ¥†‘ğ£¹Œğ¤‹…ğ£¼²åšä¿ƒ",
			score: 11
		},
		{
			name: "SDA (1)",
			string: "ğ¤…«è‚¹ğ¤‚»ğ¤„‹ç‚¹ğ£¾»ğ¤‡€ğ¤‚€ğ¤‡€êŠºğ£ª»ğ¤†»ğ¤‡‹ğ¥®”ğ£º»ğ¤‡•ğ¤¶¸ğ£¾»ğ¤‡ƒğ¥†¹ğ¡’»ğ¤…›ğ¤‡—é‚­ğ§†¹ğ¤¶¹ğ¡»ğ£¼›ğ¦¥ˆğ£ª»ğ¡’œğ¤„»ğ¢ŠŒğ¤„»ğ¤†Œè‚œğ¤¶¹ğ¡Š»ğ£½«ğ¤‡…ğ¤†¢å‚¸ğ¤š»ğ¡Š»ğ¤„»ğ¤‡¤ğ¤‚ğ£¹«ğ¤ƒ–ğ£¿‡ğ£»§ğ¤ƒ‘ğ¦¥ˆğ ª»ğ¡’œğ£¼»ğ¤§‰ğ¢Š»ğ£¾…ğ£‹‹ğ£¡‹ğ¡»ğ¡Š»ğ¢ˆ‹ğ£¸»èƒ‡é†¬ğ¡ˆ«ğ¡©«ğ¥ª¹ğ †½ğ£¿£ğ¤¹‰ğ¤ƒ£éƒ‰ç‚Œã¾¬ğ£º…ğ¤µ›æ‚¸ğ¤‚£ğ£¿ğ¤‹ğ¡ˆ»è„»è„›ğ¤ª•ğ£º¤á—Š",
			score: 17
		},
		{
			name: "SDA (2)",
			string: "ğ¤…«è‚ºğ£¾»ğ¤„‹ğ¤¶¸ğ¤‚»ğ¤‡ƒğ ª»ğ¤†»åˆğ£º»ğ£½›ğ¢¨‹ğ š¢ğ£º»ğ¤…‹ğ¤¶¸ğ¤‚»ğ¤„›ğ¤®µğ¢ª»ğ£ª»é‚¼ğ£¹‹ğ¤…‹ç‚¬ğ¤’»ğ¤†ğ¤¾´ğ¤‹ğ¤…‹ğ¤ƒ«ğ¤‡†å‚ç¶ºğ¤‡£ç¶¸ğ¤·‰ğ¡’»ğ¤„»ğ¢Šœğ¤„»é‚œğ¥†ºğ¤ªºğ¤Š»ğ¤…´ğ¤†‚å‚¹ğ¡Š»ğ£¼‹ğ¤‡ƒğ¦¾¸ğ¤‘‹è†»ğ£¹«ğ£¹›ğ¥‡‡å‚­ğ¡’´ğ£¼»ğ¤¹‰ğ¤‡£ğ¢Š¬ğ£‰»ğ¤€»ğ¤‡…ğ¤‹‹ğ£¹‹ğ¤€«ğ£¼›ğ¤ƒ‡ğ¤ƒ€æ€œğ¦ª¹ğ§†ºğ¤²„é‚¹ğ¥ª–ğ¤´ğ ¨›ç‚ğ¢Š¤ç‚ğ¢Š¼ğ£ »ê‹‡ğ¤†‚å€™å‚œã¾¬è‚œğ¤ª”ğ¤®¸ğ¤´«æ†¸ğ¢ˆ›ã¼¨ğ¤¯‹ğ †¼çœ»ğ¤º´á•‰",
			score: 20
		},
		{
			name: "Ivenris",
			string: "ğ¤‡‹ğ¤¹ğ¤†»å‚Œğ£Š»ğ¤„»êŠ¸ğ£¾»ğ¤‡‡å†ºğ¤„«ç‚œğ¢®»ğ¤†»êŠŒğ¢ª»ğ¤†»é‚Œğ¤†»ğ¤Š»ğ¤…‹ğ¤† ğ¡Š»ğ¤‚»ğ¤‡‡é†»ğ¤…‹ğ¤†ğ ®»ğ£¾»ğ¤…›ã¾Œğ¢¢»ğ¤†»æ–„ğ¤†»ğ¤††ğ¥†¸æ‚»çº»ğ¤„»å‚¼ğ¤»ğ¢Š»ğ¤„»éœğ¤¦¹ğ¡®»ğ¤Š»åƒè†¸ğ¤›ğ¤‹ğ¤‡…ğ£¾»ğ¤‡„ğ¤† ğ¤†¼ğ †œé†¹ğ£¹‹ğ¤„›ğ£­›ä‚»ğ¡¢»ğ£¦»ğ¤‚»ğ¡‰«æ‚ºç¶¸ğ¤„°å‚œå‚¬å¶Œğ¡¬‹ğ£»…ğ£»ƒğ£‰›ğ¡‰«ğ£¸°ğ£‰‹ğ¤…›ğ£»„ğ£ˆ‹ğ¡‰»ğ¤²¸å†¼ğ¢­‹ã¾¼ğ¤‚‚ğ¢¨»ğ££†è‚¹ğ£ºƒğ£›ğ£¾³",
			score: 22
		},
		{
			name: "SDA (3)",
			string: "ğ¤…«ğ¥†¹ğ£¾»ğ¤‡ğ¡Š»ğ¤„›ç‚œğ£º»ã¿ƒğ¢Š»ğ¤„»ğ †¬ğ¢®»ğ¤†»êŠŒğ¤†»è‚¸é‚¬ğ¤†»ğ¤Š»ğ¤…‹ğ †¬ğ¢Š»ğ¤…›ğ¤„‹ğ¥†¸ğ£Š»ğ¤…«ğ£»ğ¤Š»ğ¤„»ğ¥††ğ¤‡‡è‚¹è‚»ğ¤¶ºğ¢Š»ğ¤²»ğ¢®»ğ¡Š»ğ¤„»ğ ®„ç‚ğ¡ª»ğ¡’œğ¤„»ğ¢Š¬ğ¤„»ğ¤†¢å‚»ğ¡Š»ğ¤€‹ğ¤‡ƒğ¤ª¹ğ¤»ğ¤…»ğ¤‡¦ğ †¬ğ¥š¸ğ¤†»ç‚¾çººğ¦§ˆğ¤Š»ç‚œè‚»è‚»ğ¥†ºè‚¼é‚¼ğ †¼ğ¤²¸ğ¡¢»ğ£»ğ£Š»ğ¤ˆ‹ğ¤€»ğ «•ğ£º»ğ£¿‡ğ£»•ğ ™«ğ¥¢¸è¶¹ğ¤‡£ğ¤¹‰ğ¤‡£ğ¢ŠŒğ£¸»ğ¤‡¢æ—ˆğ ²»ğ¥†»å‚¬å‚¬ç‚Œç‚¬ğ †Œğ¤‚…ã¿ƒêŠŒğ¤‚„ğ¤‡…è‚¼ğ¤‚€ğ¡‹‹ğ¡‰»å«ğ¤Š¦ğ  ‹ç‚ºğ¤²¢ğ£¾²ğ œ»è‚¼ğ£»†ğ¤“‡á”»",
			score: 28
		},
		{
			name: "Deasuke",
			string: "ğ¤‡ƒğ¢Š»ğ¤„»å¶œğ¤„‹ğ¤‡ğ¡Š»ğ¤„›ğ¤†¬ğ ²»ğ¤†»ğ †œğ¢®»ğ¤†»êŠŒğ¢ª»ğ¤†»é‚Œğ¤†»ğ¤Š»ğ¤…‹ğ¤²¥ğ£¾»ğ¤„‹ğ¥†¸ğ£Š»ğ¤…›êŠŒğ¤†»ğ¤†±ç‚¼ç¶»ğ¤‹…ğ¤…´è–¹ğ£ª»ğ£Š»ğ£½»ğ¤‡†ğ¤š¢ğ£º»èµˆğ¤‡£ç¶¹ğ¤»ˆğ¤‡£ğ¤¾ºğ¤‡ƒæ‚ºğ¢¦»ğ¤‚»ğ¤… ã¢¹ğ£¾»ğ¤„›ğ¤†“ğ¤¦¹ğ¤Š»ğ¤„°ç‚œå‚¼ğ¤»ğ¢Š»ğ£²»ğ£º»ê‰Œé‚¹ğ¡Š»ğ£¹«ğ¤…‹ğ¤‡…ğ£¾»ğ¤‡„ğ“œğ š»ğ¤Š»ğ¢Š»ğ¤‰›ğ¤…«ğ¤‚‘ğ¤ƒƒğ¡‰Œğ¤µ›ğ£¹›ğ¤ğ¢‰‹ğ¡‰»ğ¡¡«ğ¤‡ ğ —ğ¤‡¡ğ¡Š„ğ¡’Œğ£¼»ç‡‰ğ£¼‹ğ¦„˜ç‚¸é‚¹ã¢¸ğ »ğ ¦»ğ¡Š»ğ£ˆ»ğ¡ˆ»ğ£ˆ›ğ¡ˆ›êŠºğ †¼ğ¤‚…ğ£»†ğ£«ƒğ¤®ºğ¤Š»ğ¡‰‹ã½»ğ£º¬ğ£ˆ›ğ¡ˆ‹ğ¤­»ğ¤‚²ğ£ˆ»ğ¤­»ğ¤Š¼ğ¢ˆ›å„›ğ¡ˆ›á”º",
			score: 30
		},
		{
			name: "chromeyhex",
			string: "ğ¤‚»æ„ˆä²»ã°‹ğ£»‹ã¼˜ğ¤‡€ğ »ğ¤‡‹å‚œğ£¾»ğ¤‡‹ğ¤†¦ğ ªµğ¤ƒ„éˆè‚¼ğ¡®»ğ¤†»çµˆğ¤‡„ğ¤†´ğ¥†¹ğ¤…›ğ¤†»ğ¤º¸ğ¤…‹ğ¤„‹ğ¥†ºğ »ğ¤†»ğ¥†ğ ª»ğ ª„ğ¤‡„ğ£ºğ¤„‹ğ¡ª„éƒˆğ¢ª»ğ¤‡„ã²¸ã°ˆğ¤„‹ğ¤Šğ¤‚»ğ¤„œğ¡ª¼ğ£¢»ğ¡Š€ğ£º»ä¸˜ğ¤‡‹ğ¤©˜ğ£¾»ğ¥„ˆğ ª»ğ¤ƒ‹ã°ˆğ¤€›è¹Œğ¤…‹ğ¤„‹ğ¡š¡ğ¤‡‹ğ¤€œç·Šğ£¥‹ğ¤†œğ¤†ğ ²¼ç¶¹ğ¥…˜ğ£¹‹ä°‰ğ£¼‹è¹Šğ¤½‹ğ¤…‹ğ¤†Œğ¤†°ğ¡š¡ä²»ğ¤‡‚ğ¤†¤ğ¡ª¥ğ£š»ğ£¢»ğ ®¤ğ¤º¸ğ¤…‹ğ¤‚„ğ¡˜œç¾¹ğ¤‡†ã¾¸ã¶¹ğ¤€Œğ¢™›ğ¡ğ¤†Œã¶ºğ¥„©ğ¡®´ãº»ğ££‹ğ¤ƒ‹ğ£›‹ğ¥†€ğ¤º¦ê‰Šğ£›„ğ š€ğ šœğ¤†€èŒğ¢Š»å¾»è¹ˆğ¢«„ğ£¾»ğ¤„Œğ¤›‹ğ¡›ğ¡«‹ç¾Œğ¡‹ã¼ˆğ¢¢Œğ¢¢¬ğ¥‚ğ¡«…ğ£ª„ğ¡Š¤è‚»ğ£Šã¼¸ğ¢ª ğ¢ª„ä‚¸ğ¡ª„è¶œğ¥€©ğ¡™‹ğ¢¢€ğ¡Š€ğ£º†ã¼©ğ¤‚„ğ¡«‡ğ¡ª´ä²¹ğ¥„‰ğ¨‚€",
			score: 31
		}
	];

	var pieces = [
		[
			"....",
			"..##",
			".##.",
			"...."
		],
		[
			"....",
			".##.",
			"..##",
			"...."
		],
		[
			"....",
			".##.",
			".##.",
			"...."
		],
		[
			"....",
			"####",
			"....",
			"...."
		],
		[
			"....",
			".###",
			".#..",
			"...."
		],
		[
			"....",
			".##.",
			".#..",
			".#.."
		],
		[
			"....",
			".###",
			"..#.",
			"...."
		]
	];
	var orientations = oriGen(pieces);
	var bar = 4;
	var wellDepth = 20; // min = bar
	var wellWidth = 10; // min = 4
	var worstPiece = worstPieceFactory(orientations, bar, wellDepth, wellWidth);
	var nextState = nextStateFactory(orientations, bar, wellDepth, wellWidth);

	var getReplay = function(string) {
		var moves = replay.decode(string);
		var state = firstState(wellDepth, worstPiece);
		moves.forEach(function(move) {
			if(state.piece === null) {
				state.piece = worstPiece(state.well, state.highestBlue);
			}
			state = nextState(state, move);
		});
		return state;
	};

	knowns.forEach(function(known) {
		it(known.name, function() {
			expect(getReplay(known.string).score).toBe(known.score);
		});
	});
});
