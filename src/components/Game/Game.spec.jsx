/* eslint-env jest */

'use strict'

import { shallow } from 'enzyme'
import React from 'react'

import Game from './Game'
import { Hatetris0 } from '../../enemy-ais/hatetris-ai'
import hatetrisRotationSystem from '../../rotation-systems/hatetris-rotation-system'

jest.useFakeTimers()

describe('<Game>', () => {
  const getGame = props => shallow(
    <Game
      bar={4}
      EnemyAi={Hatetris0}
      replayTimeout={0}
      rotationSystem={hatetrisRotationSystem}
      wellDepth={20}
      wellWidth={10}
      {...props}
    />
  )

  it('rejects a rotation system with no pieces', () => {
    expect(() => getGame({ rotationSystem: { rotations: [] } })).toThrowError()
  })

  it('rejects a well depth below the bar', () => {
    expect(() => getGame({ bar: 4, wellDepth: 3 })).toThrowError()
  })

  it('rejects a well width less than 4', () => {
    expect(() => getGame({ wellWidth: 3 })).toThrowError()
  })

  it('lets you play a few moves', () => {
    const game = getGame()
    expect(game.state()).toEqual({
      mode: 'GAME_OVER',
      wellStateId: -1,
      wellStates: [],
      replay: [],
      replayTimeoutId: undefined
    })

    game.find('.game__start-button').props().onClick()
    expect(game.state()).toEqual({
      mode: 'PLAYING',
      wellStateId: 0,
      wellStates: [{
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }],
      replay: [],
      replayTimeoutId: undefined
    })

    game.instance().onKeyDown({ keyCode: 37 }) // left
    expect(game.state()).toEqual({
      mode: 'PLAYING',
      wellStateId: 1,
      wellStates: [{
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 2, y: 0 }
      }],
      replay: ['L'],
      replayTimeoutId: undefined
    })

    game.instance().onKeyDown({ keyCode: 39 }) // right
    expect(game.state()).toEqual({
      mode: 'PLAYING',
      wellStateId: 2,
      wellStates: [{
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 2, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }],
      replay: ['L', 'R'],
      replayTimeoutId: undefined
    })

    game.instance().onKeyDown({ keyCode: 40 }) // down
    expect(game.state()).toEqual({
      mode: 'PLAYING',
      wellStateId: 3,
      wellStates: [{
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 2, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 1 }
      }],
      replay: ['L', 'R', 'D'],
      replayTimeoutId: undefined
    })

    game.instance().onKeyDown({ keyCode: 38 }) // up
    expect(game.state()).toEqual({
      mode: 'PLAYING',
      wellStateId: 4,
      wellStates: [{
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 2, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 1 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 1, x: 3, y: 1 }
      }],
      replay: ['L', 'R', 'D', 'U'],
      replayTimeoutId: undefined
    })

    game.instance().onKeyDown({ keyCode: 90, ctrlKey: true }) // Ctrl+Z
    expect(game.state()).toEqual({
      mode: 'PLAYING',
      wellStateId: 3,
      wellStates: [{
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 2, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 1 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 1, x: 3, y: 1 }
      }],
      replay: ['L', 'R', 'D', 'U'],
      replayTimeoutId: undefined
    })

    game.instance().onKeyDown({ keyCode: 89, ctrlKey: true }) // Ctrl+Y
    expect(game.state()).toEqual({
      mode: 'PLAYING',
      wellStateId: 4,
      wellStates: [{
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 2, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 0 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 0, x: 3, y: 1 }
      }, {
        well: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        score: 0,
        piece: { id: '0', o: 1, x: 3, y: 1 }
      }],
      replay: ['L', 'R', 'D', 'U'],
      replayTimeoutId: undefined
    })
  })

  describe('check known replays', () => {
    const replays = [{
      name: 'qntm-base65536',
      string: 'ð¤†»ð¤†»ð¤†»ð¤†»ð¤†»ð¡š»',
      expectedScore: 0
    }, {
      name: 'qntm-base2048',
      string: 'à¯¨à¶§à»ƒÝ¹à¯¨à¶§à»ƒÝ¹à¤ ',
      expectedScore: 0
    }, {
      name: 'Atypical-base65536',
      string: 'ã¼¬ð¤†»æ”Œð£º»ã¼Œð¤‚»ð¤‡ƒã²¬ð¤„‹ð¤†œð ¦»ð¥„¸ä‚¹ð£¸«ð¤‡ð¤¦¸ð¤„¥ð¤š¤ð¤‚»ð¤‡‹ð¤ª„ð¤†»é‚Œð£Š»ð¤…·ð“Ž»ð¤†»ð¤†„ð“Šºð¤†»ð¤„‹ã¾…ð¢¶»ð¤…›ð¤†¢ð£š»ð¤†´ð“Šºð£º»ð¤„²å‚£ã¾¹ã¾¸ð¢ª±ð¢š»ç¶¸ð¢°‹ð š»é‚Œð Š¹ð£½‹ð¤„°ç‚¸ð¤†³ð£¼°ð¤‡€ð£‹‹ð£½›èƒ‡ð“Š¸ð ª»ð¥¶»ð£™»æ‚»êŠ¬è‚¬ð“Žœð¤²¸ð¤º¸ð ¤‹ð¥‡”å‚œð¥†‘ð£¹Œð¤‹…ð£¼²åšä¿ƒ',
      expectedScore: 11
    }, {
      name: 'Atypical-base2048',
      string: 'Ï¥Ù‚à»‚ÉÆà¶–Ð”Ý¹à®¶Êˆàº‡Æ·à¯¨à³²à»ƒÜ¤Ñ¢Ù‚Ò¾×—à¢²à¶§à¸…Ú—à¯¨Î¡Ð†Ýªà¯¨à°³È£Ý¹à¢´à¶§àº‡à»’à¯¨à®¶à»ƒÜ¥à¯¨à´±Ð†Ý®à¯¨à°´Ð†Ý¥Ø°à¶¡à¬ˆÝ¹ÆÙ‚à¹“à¦…à®’à¥´à¹Ñ’à¤žà¶–Ð…Ð¸à¯¨sÇ¶É”Û‘à°¡ÐŸÝ·Þ Ù‚Ô©Ý¹à ‰àµ¿àºŸÉ“à°¤à¶«àº‡à®ˆà¦¶à©¬à·ªà¦…à ‘à¶®à¶°Ù½à¬«àµà¬†à¡¨à¦¶à««Ð¡Ü­ßœà°¯Õ¬ÝšÉ¶à¤‹à´­Ü­Ø±É¤à¸˜Óƒà°¸àµ¯',
      expectedScore: 11
    }, {
      name: 'SDA (1)-base65536',
      string: 'ð¤…«è‚¹ð¤‚»ð¤„‹ç‚¹ð£¾»ð¤‡€ð¤‚€ð¤‡€êŠºð£ª»ð¤†»ð¤‡‹ð¥®”ð£º»ð¤‡•ð¤¶¸ð£¾»ð¤‡ƒð¥†¹ð¡’»ð¤…›ð¤‡—é‚­ð§†¹ð¤¶¹ð¡Ž»ð£¼›ð¦¥ˆð£ª»ð¡’œð¤„»ð¢ŠŒð¤„»ð¤†Œè‚œð¤¶¹ð¡Š»ð£½«ð¤‡…ð¤†¢å‚¸ð¤š»ð¡Š»ð¤„»ð¤‡¤ð¤‚Žð£¹«ð¤ƒ–ð£¿‡ð£»§ð¤ƒ‘ð¦¥ˆð ª»ð¡’œð£¼»ð¤§‰ð¢Š»ð£¾…ð£‹‹ð£¡‹ð¡ž»ð¡Š»ð¢ˆ‹ð£¸»èƒ‡é†¬ð¡ˆ«ð¡©«ð¥ª¹ð †½ð£¿£ð¤¹‰ð¤ƒ£éƒ‰ç‚Œã¾¬ð£º…ð¤µ›æ‚¸ð¤‚£ð£¿ð¤‹ð¡ˆ»è„»è„›ð¤ª•ð£º¤á—Š',
      expectedScore: 17
    }, {
      name: 'SDA (1)-base2048',
      string: 'Û‘à¶§ÕªÝ¹à¨à¶§à¸”Ý¹à®®sà¶»ÝªÆà¶¢à¬ˆÝ²à¯¨à¶«à»ƒÏ†Ø°à¶œ×“Ý¶à²’à¶§Ü¨Ý¹à¦¸à¶§Ñ§Ý¹àµ­à¶¤×“Ýœà¯§à¸‹àº°à¨¨à®¤Ô€à»ƒÚ»à²œÊˆàº°à¤¸Ñ»à¶œÐ†Ñ à¯§à¸‹àº°à¤„à®®Ïºà¹€Ý¹ß¤à¶¨VÜ­Ñ»à¶³Ð†Ê…àª…à¶œØª×£à®¯Ò”Ð·Ý¢à¤Šà¶§Èà¤§Ñ»à³²Ü¨Ý·à²—à¶ Ð„à¡¨à¬«à¶Ü˜Éšà®®Êˆà¸…à¹àª·à·¦à¸…àµ©Ô¤à¹—à½šÞ¡à®¤Ô»Ñ£Ýªà¥³à±¾à»ß¢à¡ƒà°¶à¼©Ü£à®±à¶¤ÃÑšà¯¬à¶œÆ«à¦‹à­¦ÔŸÈ à¥¾à²­',
      expectedScore: 17
    }, {
      name: 'SDA (2)-base65536',
      string: 'ð¤…«è‚ºð£¾»ð¤„‹ð¤¶¸ð¤‚»ð¤‡ƒð ª»ð¤†»åˆð£º»ð£½›ð¢¨‹ð š¢ð£º»ð¤…‹ð¤¶¸ð¤‚»ð¤„›ð¤®µð¢ª»ð£ª»é‚¼ð£¹‹ð¤…‹ç‚¬ð¤’»ð¤†ð¤¾´ð¤‹ð¤…‹ð¤ƒ«ð¤‡†å‚ç¶ºð¤‡£ç¶¸ð¤·‰ð¡’»ð¤„»ð¢Šœð¤„»é‚œð¥†ºð¤ªºð¤Š»ð¤…´ð¤†‚å‚¹ð¡Š»ð£¼‹ð¤‡ƒð¦¾¸ð¤‘‹è†»ð£¹«ð£¹›ð¥‡‡å‚­ð¡’´ð£¼»ð¤¹‰ð¤‡£ð¢Š¬ð£‰»ð¤€»ð¤‡…ð¤‹‹ð£¹‹ð¤€«ð£¼›ð¤ƒ‡ð¤ƒ€æ€œð¦ª¹ð§†ºð¤²„é‚¹ð¥ª–ð¤Ž´ð ¨›ç‚Žð¢Š¤ç‚Žð¢Š¼ð£ »ê‹‡ð¤†‚å€™å‚œã¾¬è‚œð¤ª”ð¤®¸ð¤´«æ†¸ð¢ˆ›ã¼¨ð¤¯‹ð †¼çœ»ð¤º´á•‰',
      expectedScore: 20
    }, {
      name: 'SDA (2)-base2048',
      string: 'Û‘à¶§à¤²Ý¹à¤žà¶§à¸…à½§à®¶Êˆà»ƒÅ¦à¯¨à¨®Ü˜Ý¶Ø°à²—à¹„Ó”Æà¶šÐ†Ý¶à²’à¶§à¡Ý¹Øµà¶§à¤²Ý²à¯­à¶ˆàº¯à¦…à®¶Êˆà»ƒà´¡à¯¨à©²ÕªÝ¢à¯¨à½™àº‡àµ«à§Žà¶§à¤«à²à¯§Î”Î±à½§à¤Šà¶§à¸¦ÑŸà¯¨à³±Ü˜×§à®¶ÎŸà»„à¹à®’Ù‚à¸Ý¹à¢²Ù‚Ü¨Ý¹à¤à©¬á€’Ú¾Û‘à°¶àº°à¤•à®¶à¤‡à´¥à²à®¤Ô»Ñ£Ý¸à²£Ò”à¬œÝ¸à±»à¶«à»„à¦…à à¶¡Ü˜Ñ£à®¶sà¡Ž×—à§­Ø¾à«­à¦”à®¤à¶žà­©Ú½à´¡à°²Ñ£Ý¢à¦·Ü¯à»ÑŸà®¹Úà«­×—É¢à¶ Ã×œà®®ÎŸÕ«à¥¾à±¯Ù…àº¯×à®®ÈºÐ‰Þƒà¯®àµ¿à´™Ú¾à 7',
      expectedScore: 20
    }, {
      name: 'Ivenris-base65536',
      string: 'ð¤‡‹ð¤ž¹ð¤†»å‚Œð£Š»ð¤„»êŠ¸ð£¾»ð¤‡‡å†ºð¤„«ç‚œð¢®»ð¤†»êŠŒð¢ª»ð¤†»é‚Œð¤†»ð¤Š»ð¤…‹ð¤† ð¡Š»ð¤‚»ð¤‡‡é†»ð¤…‹ð¤†ð ®»ð£¾»ð¤…›ã¾Œð¢¢»ð¤†»æ–„ð¤†»ð¤††ð¥†¸æ‚»çº»ð¤„»å‚¼ð¤ž»ð¢Š»ð¤„»éœð¤¦¹ð¡®»ð¤Š»åƒè†¸ð¤›ð¤‹ð¤‡…ð£¾»ð¤‡„ð¤† ð¤†¼ð †œé†¹ð£¹‹ð¤„›ð£­›ä‚»ð¡¢»ð£¦»ð¤‚»ð¡‰«æ‚ºç¶¸ð¤„°å‚œå‚¬å¶Œð¡¬‹ð£»…ð£»ƒð£‰›ð¡‰«ð£¸°ð£‰‹ð¤…›ð£»„ð£ˆ‹ð¡‰»ð¤²¸å†¼ð¢­‹ã¾¼ð¤‚‚ð¢¨»ð££†è‚¹ð£ºƒð£›ð£¾³',
      expectedScore: 22
    }, {
      name: 'Ivenris-base2048',
      string: 'à²³à¶§Ü¤Ý¹à®œÆ£à»à¡‘à¯¨à°½à»ƒÝšÞ›à¶¡Ü¦Ý¹à¦°à¶§à¹Ý¹à®œÑƒà»€à¦…à¯§Úˆà»ƒÝ¹à¯©ÎŸà»€É•à¯§Ú à»à¤”à¯¨à«®Ð†Ü¢à¯¨à¶šÜ˜Ý“à¯¨à±¾Ð†Ý à¯¨à¶šÆ”Ý¹à®•Ù‚à¸†Ý¹Ï¢à¶ˆÕ€Ý¹à°­à¶¨ÃÝšÑ»à¶É‘ÝšÑ»à²¬à»ƒà¡ É·à°³É‘Ý¢à¯¨Úˆà»ƒÝ·à±«à¶¡Ð†Þ‰à®®Ò”à¸˜à¡¨à®à¶§àµ§Ûà¬›Ù‚ÔŸÝ±à¯¨à´®à¸†Ý à¯§Î‘à°·ÝšÉ·Ù´à¸…Õ‰à®¤à¸ƒà¸…Ý¶Ø°ÚŒà¸…Ù½à ‘àµÜ˜Þ‚à®Ø¾Ê‘É¥à¢¶Ù„ÜªÝ£à¯«Ø³à¬…Ý¸Ô«×¦à¸–Ü¤à®“à¶¥ÛµÝ',
      expectedScore: 22
    }, {
      name: 'SDA (3)-base65536',
      string: 'ð¤…«ð¥†¹ð£¾»ð¤‡ð¡Š»ð¤„›ç‚œð£º»ã¿ƒð¢Š»ð¤„»ð †¬ð¢®»ð¤†»êŠŒð¤†»è‚¸é‚¬ð¤†»ð¤Š»ð¤…‹ð †¬ð¢Š»ð¤…›ð¤„‹ð¥†¸ð£Š»ð¤…«ð£ž»ð¤Š»ð¤„»ð¥††ð¤‡‡è‚¹è‚»ð¤¶ºð¢Š»ð¤²»ð¢®»ð¡Š»ð¤„»ð ®„ç‚Žð¡ª»ð¡’œð¤„»ð¢Š¬ð¤„»ð¤†¢å‚»ð¡Š»ð¤€‹ð¤‡ƒð¤ª¹ð¤Ž»ð¤…»ð¤‡¦ð †¬ð¥š¸ð¤†»ç‚¾çººð¦§ˆð¤Š»ç‚œè‚»è‚»ð¥†ºè‚¼é‚¼ð †¼ð¤²¸ð¡¢»ð£ž»ð£Š»ð¤ˆ‹ð¤€»ð «•ð£º»ð£¿‡ð£»•ð ™«ð¥¢¸è¶¹ð¤‡£ð¤¹‰ð¤‡£ð¢ŠŒð£¸»ð¤‡¢æ—ˆð ²»ð¥†»å‚¬å‚¬ç‚Œç‚¬ð †Œð¤‚…ã¿ƒêŠŒð¤‚„ð¤‡…è‚¼ð¤‚€ð¡‹‹ð¡‰»å«ð¤Š¦ð  ‹ç‚ºð¤²¢ð£¾²ð œ»è‚¼ð£»†ð¤“‡á”»',
      expectedScore: 28
    }, {
      name: 'SDA (3)-base2048',
      string: 'Û‘à¶§Ý•Ý¹à¦¯à¶§àº°à ‡à¯§à·ªà»ƒÜ­Ð˜à¶§Ü¨Ý¹àª¸à¶§à¹Ý¹à®œÑƒà»ƒÝ¶Ô¥Úˆà»ƒÝ¹à¯©ÎŸà»à¤”à¯§à¸ƒà»‚É•à¯§Ú à»à¤„à¯¨à¶¥Ü˜Þà¯¨à±˜Ðˆà½§à®¤Ù‚à´«ÝªÞ›à³²à»„àµ«à©«à¶œÆ¬Ý¶ÔŠà²‹à»ƒÝ’à¦·Ü¯à»ƒ×¥à±šà¶§à¢©Ý¹É·à¶œVÝªÑ»à¶ È£Ý»Þ›à¶³à¬ˆ×£à¯§Ú´à»ƒÝ¼Ñ»à´¦Ýà²à¯©Ô¹à»ƒÚ½à¯Ù‚à¬­Þ‚à¯©Ïºà¼©Ý¶à²ˆà¶à¬ˆÚà®¶sà¼¡Ý¸àµ˜ÎŸàº°à¤”à§¡à¶šà«­É’à´©à²¬Ñ£Ý²à¦·Ü¯àº°à¤¸Ñ»à²‹à¬ˆà¤œÆà°½à»ÝªÉ·Ù´à¸…Ý¸à±šà²€àº¯à®‡à°¸Ø¶É±Å¦àª·à¶§à¼£Ü¡à®¶Ø¶Ê‘É à¬¢à´®à»˜Ü£à®±à¶¡à¬¢Úà¤¹à°¥à¼£Þ„à®œÒ•à¤',
      expectedScore: 28
    }, {
      name: 'Deasuke-base65536',
      string: 'ð¤‡ƒð¢Š»ð¤„»å¶œð¤„‹ð¤‡ð¡Š»ð¤„›ð¤†¬ð ²»ð¤†»ð †œð¢®»ð¤†»êŠŒð¢ª»ð¤†»é‚Œð¤†»ð¤Š»ð¤…‹ð¤²¥ð£¾»ð¤„‹ð¥†¸ð£Š»ð¤…›êŠŒð¤†»ð¤†±ç‚¼ç¶»ð¤‹…ð¤…´è–¹ð£ª»ð£Š»ð£½»ð¤‡†ð¤š¢ð£º»èµˆð¤‡£ç¶¹ð¤»ˆð¤‡£ð¤¾ºð¤‡ƒæ‚ºð¢¦»ð¤‚»ð¤… ã¢¹ð£¾»ð¤„›ð¤†“ð¤¦¹ð¤Š»ð¤„°ç‚œå‚¼ð¤ž»ð¢Š»ð£²»ð£º»ê‰Œé‚¹ð¡Š»ð£¹«ð¤…‹ð¤‡…ð£¾»ð¤‡„ð“Žœð š»ð¤Š»ð¢Š»ð¤‰›ð¤…«ð¤‚‘ð¤ƒƒð¡‰Œð¤µ›ð£¹›ð¤ð¢‰‹ð¡‰»ð¡¡«ð¤‡ ð ž—ð¤‡¡ð¡Š„ð¡’Œð£¼»ç‡‰ð£¼‹ð¦„˜ç‚¸é‚¹ã¢¸ð ž»ð ¦»ð¡Š»ð£ˆ»ð¡ˆ»ð£ˆ›ð¡ˆ›êŠºð †¼ð¤‚…ð£»†ð£«ƒð¤®ºð¤Š»ð¡‰‹ã½»ð£º¬ð£ˆ›ð¡ˆ‹ð¤­»ð¤‚²ð£ˆ»ð¤­»ð¤Š¼ð¢ˆ›å„›ð¡ˆ›á”º',
      expectedScore: 30
    }, {
      name: 'Deasuke-base2048',
      string: 'à±šà¶§à¸¥Ý¹à®®ÈºÐ†Ý¿à¯¨à¶œÃÝ¸à²³à¶§É±Ý¹à¦¶à¶§à¹Ý¹à®œÑƒà»€à¦…à¯§Úˆà»ƒÝ¹à¯©ÎŸà»€à®œà¯¨à²—à»ƒÜ­à¯¨àµÜ˜Ü­Û‘à¶§àºœÝ¹à±šà¶¦Í²à®‰Ý£à¶§Õ´Ý¹Ô¥àµà»ƒÑ¢à¯¨ÉŠÐ†Ü¥à¡‚Ü¯à»ƒÏà²›Ô€à»ƒÝªà¦°à¶§à¹€Ý¹à¨«à¶§à¦‹Ý¹à¤›Ù‚à¸Ý¹à¤¹à¶§Ü¨Ý¹à°¸Ù‚Ü¨ÝºÉ·à¶©Ü˜Ñ§à¯¦Ù‚à·†à¤„à®¤à¶§à¸…àµ«à ‘à¶¨É‘Ý¹à®®ÎŸà¸¥àºà®Ù‚à¼±ÝšØ°à¸‡à»ƒÍ·àª¶à¶¢Ð¥à¢­à²Žà¶§È»Ý¢à®®Ò”Ð¡Ýà·‚à¶žà·€à±˜à®“ÓºÐ¥à²à®®Ô—VÝà¤†à¶–à»ƒÏ à®ÎŸà·€Ý¶Ñ»à±¾à»à¡‘à¢²à¶¤ÃÉ¥àª…à¶ªàº¯à®‡à²ˆà±¾àº£ÝªØ°à¶ªÏ½à¤”ÆÚ Ã×œà®œÒ•É×–Ñ»Úà¼¥Þ‰à°­à³¯Û±à ‡à¢³àµ¯',
      expectedScore: 30
    }, {
      name: 'chromeyhex-base65536',
      string: 'ð¤‚»æ„ˆä²»ã°‹ð£»‹ã¼˜ð¤‡€ð ž»ð¤‡‹å‚œð£¾»ð¤‡‹ð¤†¦ð ªµð¤ƒ„éˆè‚¼ð¡®»ð¤†»çµˆð¤‡„ð¤†´ð¥†¹ð¤…›ð¤†»ð¤º¸ð¤…‹ð¤„‹ð¥†ºð ž»ð¤†»ð¥†ð ª»ð ª„ð¤‡„ð£ºð¤„‹ð¡ª„éƒˆð¢ª»ð¤‡„ã²¸ã°ˆð¤„‹ð¤Šð¤‚»ð¤„œð¡ª¼ð£¢»ð¡Š€ð£º»ä¸˜ð¤‡‹ð¤©˜ð£¾»ð¥„ˆð ª»ð¤ƒ‹ã°ˆð¤€›è¹Œð¤…‹ð¤„‹ð¡š¡ð¤‡‹ð¤€œç·Šð£¥‹ð¤†œð¤†ð ²¼ç¶¹ð¥…˜ð£¹‹ä°‰ð£¼‹è¹Šð¤½‹ð¤…‹ð¤†Œð¤†°ð¡š¡ä²»ð¤‡‚ð¤†¤ð¡ª¥ð£š»ð£¢»ð ®¤ð¤º¸ð¤…‹ð¤‚„ð¡˜œç¾¹ð¤‡†ã¾¸ã¶¹ð¤€Œð¢™›ð¡žð¤†Œã¶ºð¥„©ð¡®´ãº»ð££‹ð¤ƒ‹ð£›‹ð¥†€ð¤º¦ê‰Šð£›„ð š€ð šœð¤†€èŒð¢Š»å¾»è¹ˆð¢«„ð£¾»ð¤„Œð¤›‹ð¡›ð¡«‹ç¾Œð¡‹ã¼ˆð¢¢Œð¢¢¬ð¥‚ð¡«…ð£ª„ð¡Š¤è‚»ð£Šã¼¸ð¢ª ð¢ª„ä‚¸ð¡ª„è¶œð¥€©ð¡™‹ð¢¢€ð¡Š€ð£º†ã¼©ð¤‚„ð¡«‡ð¡ª´ä²¹ð¥„‰ð¨‚€',
      expectedScore: 31
    }, {
      name: 'chromeyhex-base2048',
      string: 'à¯¨à´–ÆŒÝ¯ßœà Ð†WÆ‘sà»ƒaà¯¨à³¯Ü˜Ý·à²³à¶¢à¬ˆÛŒÔªØ¼Ê¥ÝºÔ¥à¶žÜ˜Ý²à Ú„à»‚à¦…à®®Ø©à»ƒÝ¹à¯§Ú“Ð†Ù½à¯¨àµžà»ƒZà¯¨à²˜Ð†Ü¥à Î£Ð†Zßœà¶§Èœà¦–Ø°à¶¢ÐÝ¹ß›eÊ›Ý¹ß¤à¸›à»€Ñ§à¯©Ôšà»‚Õ‰à¢¸à¶§uÐ°à¯¨àª¸È£Ý·Å‚Ù‚à·†à¦…à¨eÜ˜Ô”×¦Ù‚à°·Ý¸É¢Ú àºœà¦€à²§Ò¸àº¡Ñ§à®à¶§à¼ªàµ©ÔŠà²…à´«Ü¡à¤¥sà¸–Ô¡Ô¦Ôšà»ƒÉ¥à®¸Ù‚à¡ˆÉ•É Éˆà¹„Ý¸×¦Ù‚à°·Ý°à¨µÏºÐ¤à¦…à®“Ø»ÝÉ“ÔžÑƒàº¯É•à¤à¡ˆà¹Ýžà¤à¢¶Ð†Ýžà¤®à¸›à´¦à®ˆÆ‰Ø¿à¬­Ýªà®¸Ò©Ð‚àµ¸Ô›Ù…Ï¦GÆÒ¨VÚ¾Ô¥à¶ Ð…Õ·à¡‚à·®à¤²Ý·Æ˜à¶«à»˜à …Æ˜à²§Ð×§à¢»Ò¨à¸†Ó˜à²¦Ô‹Ïà¬ªà ‘à©§Í³Ý²à®ŸÖƒà¶»Ýžà¨µÎšÏ¼É¢Ô’ÔºÙ³Ñ¦Ô¤à ŒÎ¾Gà²˜Ø³à¨¯Ü¥à®¶Ò‹Ï®Ï„à¤¥lÏ¼Ê”',
      expectedScore: 31
    }]

    replays.forEach(replay => {
      it(replay.name, () => {
        jest.spyOn(window, 'prompt').mockReturnValueOnce(replay.string)
        const game = getGame()
        game.instance().handleClickReplay()

        while (game.state().replayTimeoutId !== undefined) {
          jest.runAllTimers()
        }

        const state = game.state()
        expect(state.mode).toBe('GAME_OVER')
        expect(state.wellStates[state.wellStateId].score).toBe(replay.expectedScore)
      })
    })
  })
})
